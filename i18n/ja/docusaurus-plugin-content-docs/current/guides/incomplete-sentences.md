---
title: Ankiの不完全な文章を修正する
sidebar_label: 不完全な文章
sidebar_position: 2
---

import Admonition from '@theme/Admonition';

## 問題

Ankiカードを作成すると、`Sentence`フィールドが途中で切れてしまうことがあるのに気づくかもしれません。これはGSMが原因ではなく、Yomitanが文の終わりをどのように判断するかが原因です。デフォルトでは、`。`、`！`、`？`などの句読点を使用します。

例えば、ゲーム内の全文が次の場合：
`ゲーマーＣ「対戦ありがとうございました。やっぱりさや猫さんにはまだまだ敵わないみたいですね」`

単語を検索する場所によっては、Yomitanは文として次の一部のみをキャプチャする可能性があります：
- `対戦ありがとうございました。`
- `やっぱりさや猫さんにはまだまだ敵わないみたいですね`

GSMは*全*行の音声とスクリーンショットをキャプチャしますが、カードのテキストは不完全になります。

## 解決策：Yomitanプロファイル

これを解決する最善の方法は、GSMのテキストフッカーページでのみアクティブになり、文を分割するために異なるルールを使用する専用のYomitanプロファイルを作成することです。

### 1. 新しいプロファイルを作成する

Yomitanの設定で、`プロファイル`セクションに移動し、新しいプロファイルを作成します。名前は「GSM」または「Texthooker」とすることができます。

![新しいYomitanプロファイルの作成](https://github.com/user-attachments/assets/09770ed6-fdec-4791-af20-0df0aaebecd5)

### 2. プロファイル条件を設定する

テキストフッカーページにいるときに、この新しいプロファイルに自動的に切り替わるように条件を設定します。

-   **タイプ**: `URLが一致`
-   **パターン**: `http://localhost:55000/*`

:::tip
GSMのテキストフッカーのデフォルトポートは`55000`です。GSMの設定でこれを変更した場合は、ここでもURLパターンのポート番号を更新してください。
:::

![テキストフッカーのURLに一致するようにプロファイル条件を設定する](https://github.com/user-attachments/assets/47a80f26-8e69-4854-9cf8-0032120ce55c)

### 3. 文の終端方法を設定する

新しい「GSM」プロファイルがアクティブな状態で、`設定 -> 解析`に移動します。**文の終端文字**オプションを**改行のみ**に変更します。

![文の終端を改行のみに設定する](https://github.com/user-attachments/assets/b96a3a83-f09b-4513-ab9a-0fb2a258e78d)

これで、YomitanはGSMから送信された行全体を単一の文として扱い、Ankiカードに完全な文脈が含まれるようになります。

### オプション：テキストフッカーでクリーンアップする

一貫した動作を確保するために、テキストフッカーの内蔵正規表現置換を使用して、改行文字（`\n`）を何もないものに置き換えることができます。これにより、各ゲーム行が単一の段落に強制され、「改行のみ」設定とうまく連携します。

![テキストフッカーUIで正規表現を使用して改行を削除する](https://github.com/user-attachments/assets/50537106-c98a-4205-a4c2-09be06ad36be)
